# Phase I: Quantum Generation & Physical Setup

## 1. Executive Summary
Phase I constitutes the physical bedrock of the E-HOK protocol. Its primary function is twofold: (1) to generate correlated raw material (bit strings $s, \bar{s}$ and basis strings $a, \bar{a}$) via quantum entanglement, and (2) to establish the **root of trust**. In the E-HOK framework, trust is not derived from algorithmic hardness (as in RSA) but from physical constraints: the **Noisy Storage Model (NSM)**.

The core challenge in this phase is ensuring that the **trusted noise** (imperfections in honest devices/channels) is strictly lower than the **untrusted noise** (decoherence in the adversary’s memory). If this condition is violated, no amount of classical post-processing (Phase IV/V) can distill a secure key.

---

## 2. Key Theoretical and Mathematical Insights

The protocol must adhere to specific inequalities derived from the literature to guarantee that the generated keys are truly oblivious.

### A. The "Strictly Less" Condition (The Hard Feasibility Limit)
The fundamental security condition for E-HOK is that the information leakage due to channel errors must be less than the uncertainty generated by the adversary's noisy storage.
*   **Theoretical Basis:** *Schaffner et al.* derived that for depolarizing noise, security is only possible if the channel noise is strictly less than the storage noise.
    > "Our result [...] shows that even for a very high storage rate, there is a positive rate of $\lambda$ for many reasonable settings." — *Schaffner et al.* [2]
*   **Mathematical Insight:** *Lupo et al.* refined this bound using tighter entropic uncertainty relations. They established that if the trusted noise (channel error + device error) exceeds a specific threshold, security is mathematically impossible because a "rational" adversary would simply measure honest qubits immediately rather than store them.
    *   **The Hard Limit:** For a depolarizing channel, the trusted noise ($r_{trusted}$) must satisfy:
        $$ h \left( \frac{1+r_{trusted}}{2} \right) \le 1/2 \implies r_{trusted} \gtrsim 0.78 $$
        This implies a maximum tolerable error rate (Quantum Bit Error Rate - QBER) of approximately **22%**.
        $$ P_{error} \lesssim 22\% $$
        See Eq. (43) and discussion in Section VI of *Lupo et al.* [3].
*   **Schaffner's Conservative Limit:** Earlier work by *Schaffner et al.* provides a more conservative bound for robust protocols, suggesting a QBER limit closer to **11%** for specific storage parameters (Corollary 7) [2].

### B. The Noisy Storage Capacity Constraint
The security of the "Oblivious Key" relies on Bob (the potential adversary) being unable to store the quantum state perfectly.
*   **Theoretical Basis:** *König et al.* define the "Weak String Erasure" (WSE) primitive, which E-HOK implements. For security to hold, the capacity of the adversary's storage channel ($C_{\mathcal{N}}$) multiplied by their storage rate ($\nu$) must satisfy a specific bound relative to the dimension of the encoding (BB84 uses dimension 2).
*   **Mathematical Insight:** The protocol is secure only if:
    $$ C_{\mathcal{N}} \cdot \nu < \frac{1}{2} $$
    See Eq. (13) and Corollary I.2 in *König et al.* [4].
    This inequality dictates the minimum wait time $\Delta t$. The wait time must be sufficient to degrade the adversary's effective channel capacity $C_{\mathcal{N}}$ below this threshold.

### C. Hybrid Commitment Architecture
*   **Theoretical Basis:** The E-HOK protocol uses a "hybrid" approach. *Lemus et al.* [1] propose using classical cryptographic hash functions as commitments ($\pi_{COMH}$). However, *Schaffner et al.* [2] and *Faleiro et al.* [5] demonstrate that physical delays or Time-Lock Puzzles (TLP) provide "everlasting security" that does not rely on the computational hardness of hashes in the long term.
*   **Insight:** The "Commitment" in E-HOK is actually a enforcement of the **sequence of events**: Bob must measure (or map to noisy storage) *before* Alice reveals the bases.

---

## 3. Key Implementation Requirements

To satisfy the theoretical insights above, the E-HOK simulation/experiment must implement the following specific checks and modules.

### Requirement 1: The "Pre-Flight" Feasibility Check
Before the protocol proceeds to transmission, the system must validate that a secure key is theoretically possible given the device parameters.
*   **Action:** The simulation must accept input parameters for Source Quality ($\mu$), Detection Efficiency ($\eta$), and Intrinsic Error ($e_{det}$), as defined in *Erven et al.* [6], Table I.
*   **Logic:**
    1.  Calculate the expected total trusted noise $Q_{total}$.
    2.  Calculate the minimum necessary storage noise $r_{storage}$ required to beat $Q_{total}$ using *Lupo et al.* Eq. (36) [3]:
        $$ h_{min} \ge \max \left\{ \Gamma [1 - \log (1 + 3r^2)], 1 - r \right\} $$
    3.  **Abort Condition:** If $Q_{total} > 22\%$, the protocol must abort immediately with a "Security Impossibility" error. The system should warn if $Q_{total} > 11\%$ (conservative limit).

### Requirement 2: Strict Enforcement of Wait Time ($\Delta t$)
The ordering of events is the primary attack surface in Phase I.
*   **Action:** The protocol flow must be:
    1.  Alice sends Qubits.
    2.  Bob acknowledges receipt (and commits to measurements implicitly or explicitly).
    3.  **Alice starts timer** for duration $\Delta t$.
    4.  **Only after timer expires:** Alice sends Basis String $a$.
*   **Calibration:** $\Delta t$ must be calibrated based on the specific decoherence times assumed for the adversary. If modeling a fiber-loop memory or atomic ensemble as per *Erven et al.* [6], $\Delta t$ might be in the range of milliseconds to seconds.

### Requirement 3: Modular Commitment Module (TLP vs. Physical)
To address the "Advanced Variant" mentioned in the E-HOK overview, the implementation should offer two modes for the commitment phase:
*   **Mode A (Physical):** Uses the wait time $\Delta t$ described above.
*   **Mode B (Computational/One-Shot):** Implements the Time-Lock Puzzle (TLP) described by *Faleiro et al.* [5].
    *   *Implementation:* Alice encrypts the basis string $a$ in a puzzle $\mathcal{Z}$ that requires $\tau$ sequential computations to solve.
    *   *Constraint:* The time to solve $\tau$ must be greater than the decoherence time of Bob's memory ($\tau > \Delta t_{decoherence}$).

---

## 4. Strengths and Critical Aspects

### Strengths
1.  **Everlasting Security:** By grounding the protocol in the **Noisy Storage Model** (König/Schaffner), the security does not degrade over time even if quantum computers break classical hash functions (unlike the baseline Lemus protocol).
2.  **High Error Tolerance:** Leveraging the bounds from *Lupo et al.* allows the protocol to operate in higher noise regimes (up to ~22%) than standard QKD, making it more viable for near-term hardware.
3.  **Experimental Viability:** The protocol parameters (efficiency, dark counts) are grounded in the real-world validation provided by *Erven et al.*, ensuring the simulation reflects reality.

### Critical Aspects (Failure Modes)
1.  **The "Strictly Less" Violation:** If the honest channel noise is underestimated during the "Pre-Flight Check," the protocol might generate a key that is fully recoverable by a cheating Bob who has slightly better storage than assumed. The margin between $P_{error}$ (honest) and $P_{noise}$ (adversary) is the *only* source of security.
2.  **Timing Side-Channels:** In a physical implementation, if Alice sends the basis string $a$ before the wait time $\Delta t$ has fully elapsed (due to network latency or clock drift), Bob can perform a coherent attack, measuring in the correct basis and breaking obliviousness.
3.  **Loss Sensitivity:** As noted by *Erven et al.* (Fig. 2), the secure rate drops drastically with transmission efficiency ($\eta$). If $\eta$ is too low (< 1.5% in their experiment), the "Strictly Less" condition may become impossible to satisfy because the error correction overhead consumes the entire key.

---

## 5. References
*   [1] `Generation and Distribution of Quantum Oblivious Keys for Secure Multiparty Computation.md` (Lemus et al., 2020)
*   [2] `ROBUST CRYPTOGRAPHY IN THE NOISY-QUANTUM-STORAGE MODEL.md` (Schaffner et al., 2009)
*   [3] `Error-tolerant oblivious transfer in the noisy-storage model.md` (Lupo et al., 2023)
*   [4] `Unconditional-security-from-noisy-quantum-storage.md` (König et al., 2012)
*   [5] `Non-Interactive Oblivious Transfer and One-Time Programs.md` (Faleiro et al., n.d.)
*   [6] `An Experimental Implementation of Oblivious Transfer in the Noisy Storage Model.md` (Erven et al., 2014)